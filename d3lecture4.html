<!doctype html>
<html>
<style>
    body {
      padding: 10px;
      background: #000;
    }

</style>

<head>
    <title>D3 tutorial</title>
    <script src = "http://d3js.org/d3.v3.min.js"></script>
    <script src = "riffwave.js"></script>
</head>

<body>
	
	<script>


		var dataArray = [];

		for (var i=0, t=50; i<t; i++) {
    		dataArray.push(Math.round(Math.random() * t))
		};
		
		var height = 500;

		var barWidth = 10;

		var width = dataArray.length * (barWidth + 10);

		var audio = new Audio(); // create the HTML5 audio element
				var wave = new RIFFWAVE(); // create an empty wave file
				var data = []; // yes, it's an array

				wave.header.sampleRate = 44100; // set sample rate to 44KHz
				wave.header.numChannels = 2; // two channels (stereo)

				var i = 0;
				while (i<100000) { 
				  data[i++] = 128+Math.round(127*Math.sin(i/10)); // left speaker
				  data[i++] = 128+Math.round(127*Math.sin(i/200)); // right speaker
				}

			wave.Make(data); // make the wave file
			audio.src = wave.dataURI; // set audio source
			audio.play()

		var canvas = d3.select("body")
						.append("svg")
						 
						.attr("width", width + 50)
						.attr("height", height + 50)
						.append("g")												//this groups all the SVG elements
						.attr("transform", "translate(50,500)"); 					//if you're using this, remember this is not independent from 											
						

		var heightScale = 	d3.scale.linear()
							.domain([0, Math.max.apply(Math, dataArray)]) 		// continuous input domain; scales according to the max value
							.range([0, height ]);									// continuous output range


		var colorScale = d3.scale.linear()
							.domain([0, dataArray.length]) 
							.range(["red","blue"]);

		var myMouseoverFunction = function() {
				var rectangle_col = d3.select(this);
				
				rectangle_col.transition()
				.duration(800)
				.attr("height", rectangle_col.attr("height")*1 - 20)
				.ease("elastic")
				.attr("fill", "purple")
				
				audio.play(); // we should hear two tones one on each speaker
			}

		var myMouseoutFunction = function() {
				var rectangle_col = d3.select(this);
				rectangle_col.transition()
				.duration(800)
				.ease("elastic")
				.style('fill', this.getAttribute('initialcolor'))
				.attr('height', this.getAttribute('initialheight'))
				
				;
			}

		var bars = canvas.selectAll("rect")
							.data(dataArray)
							.enter()
								.append("rect")
								.attr("height", 0)
								.attr("width", barWidth)
								.attr("x", function(d,i){ return i*(-barWidth-5); })
								.attr("transform", "rotate(180)")
								.attr("initialcolor", function(d,i){return colorScale(i)})
								.attr("initialheight", function(d){ return heightScale(d);})
								.attr("fill", function(d,i){return colorScale(i)	} )
								.on("mouseover", myMouseoverFunction)
								.on("mouseout", myMouseoutFunction)
									.transition()
									//.delay(function(d, i) { return i * 60 })
									.duration(500)
									.attr("height", function(d){ return heightScale(d);});
									
		
									
								

		
	</script>
</body>
</html>